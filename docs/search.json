[
  {
    "objectID": "tutorial.html",
    "href": "tutorial.html",
    "title": "Tutorial",
    "section": "",
    "text": "library(spatInfer)\nVignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The html_vignette output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible.\nlibrary(spatInfer)\n\ndata(opportunity)\nset.seed(123)\nopportunity=opportunity |&gt; dplyr::slice_sample(n=100)"
  },
  {
    "objectID": "tutorial.html#choose-the-spatial-basis",
    "href": "tutorial.html#choose-the-spatial-basis",
    "title": "Tutorial",
    "section": "1. Choose the Spatial Basis",
    "text": "1. Choose the Spatial Basis\nNow run the regression and print output\n\noptimal_basis(mobility~racial_seg+single_mom, opportunity,\n              max_splines=5)\n\n\n\n\n\n\n\nFigureÂ 1"
  },
  {
    "objectID": "tutorial.html#run-placebo-test",
    "href": "tutorial.html#run-placebo-test",
    "title": "Tutorial",
    "section": "2. Run Placebo Test",
    "text": "2. Run Placebo Test\nnext run placebo test.\n\nplbo=placebo(mobility~racial_seg+single_mom, opportunity,\n                 splines=4, pc_num=3,\n                 nSim=50,\n                 Parallel=T\n                 )\nplacebo_table(plbo)\n\n \n\n  \n    \n    \n    tinytable_7t11k9me9bt1uustocz6\n    \n    \n    \n    \n  \n\n  \n    \n      \n        \n        \n              \n                Clusters\n                Est p\n                Plac p\n                Plac 5%\n                CI Width\n                CI\n              \n        \n        Moran=3.34, Structure=0.03, Effective Range=0.15, R2=0.02.\nSplines=4, PCs=3.\nEstimated and placebo p values and proportion of placebo regressions significant at 5%, along\n                with confidence intervals. R2 gives the explanatory power of a regression of the treatment on the principal components.\n        \n                \n                  .\n                  0.4 \n                  0.38\n                  0.06\n                  4.7\n                  [-3.34, 1.34]\n                \n                \n                  3\n                  0.45\n                  0.46\n                  0.02\n                  9.2\n                  [-5.61, 3.61]\n                \n                \n                  4\n                  0.38\n                  0.44\n                  0.1 \n                  6.2\n                  [-4.12, 2.12]\n                \n                \n                  5\n                  0.39\n                  0.4 \n                  0.04\n                  5.8\n                  [-3.89, 1.89]\n                \n                \n                  6\n                  0.51\n                  0.46\n                  0.06\n                  7.2\n                  [-4.61, 2.61]"
  },
  {
    "objectID": "tutorial.html#run-a-synthetic-outcome-test",
    "href": "tutorial.html#run-a-synthetic-outcome-test",
    "title": "Tutorial",
    "section": "3. Run a Synthetic Outcome Test",
    "text": "3. Run a Synthetic Outcome Test\nFollowing the placebo test, the next step is to calculate the synthetic outcome p-value: What is the significance level of the null hypothesis that the outcome is determined by trending noise of a specified form?\nWe assume that the outcome is generated as a quadratic in longitude and latitude with residuals again being generated by a spatial noise process with the same exponential parameters: here there is a structure of 0.37 and effective range of 0.1.\n\nsynt_bch=synth_bch(mobility~racial_seg+single_mom,  opportunity,\n                 splines=4, pc_num=3,\n                  nSim=50,\n                 Parallel=T)\nsynth_table(synt_bch)\n\n \n\n  \n    \n    \n    tinytable_w62xo9apwlvh445mji3q\n    \n    \n    \n    \n  \n\n  \n    \n      \n        \n        \n              \n                Clusters\n                Est p\n                Synth p\n                CI Width\n                CI\n              \n        \n        Moran=3.34, Structure=0.89, Effective Range=0.1, R2=0.36.\nSplines=4, PCs=3.\nEstimated and synthetic outcome p values for different cluster numbers.\n                R2 gives the explanatory power of a regression of the outcome on a quadratic in longitude and latitude.\n        \n                \n                  .\n                  0.4 \n                  0.6 \n                  4.7\n                  [-3.34, 1.34]\n                \n                \n                  3\n                  0.45\n                  0.62\n                  9.2\n                  [-5.61, 3.61]\n                \n                \n                  4\n                  0.38\n                  0.58\n                  6.2\n                  [-4.12, 2.12]\n                \n                \n                  5\n                  0.39\n                  0.56\n                  5.8\n                  [-3.89, 1.89]\n                \n                \n                  6\n                  0.51\n                  0.68\n                  7.2\n                  [-4.61, 2.61]\n                \n        \n      \n    \n\n    \n\n  \n\n\n\n\nFor the three clusters chosen by the placebo test, the synthetic outcome significance level is 0.02, identical to the placebo one."
  },
  {
    "objectID": "tutorial.html#estimate-the-spatial-basis-regression",
    "href": "tutorial.html#estimate-the-spatial-basis-regression",
    "title": "Tutorial",
    "section": "4. Estimate the Spatial Basis Regression",
    "text": "4. Estimate the Spatial Basis Regression\nThe fact that the placebo and synthetic outcome significance levels closely match the regression one gives us considerable confidence in the reliability of the regression estimate. We therefore estimate a regression with 4 principal components of a 4x4 spline, and compute standard errors using 3 k-medoids clusters.\nFor comparison we also include a regression with no spatial adjustment where standard errors are clustered by state.\n\nCK=CK_regression(mobility~racial_seg+single_mom,  opportunity,\n                 splines=4,pc_num=3,\n                 clusters=3)\n\nClust=fixest::feols(mobility~racial_seg+single_mom,  opportunity,\n              cluster= ~state)\n\nmodelsummary::modelsummary(list(Clustered=Clust, Basis=CK),\n                           statistic = c(\"conf.int\",\"p = {p.value}\"),\n                           coef_omit = c(\"Intercept|PC*\"), #omit basis and intercept\n                           gof_map = c(\"nobs\", \"r.squared\"),\n                            fmt=2)\n\n \n\n  \n    \n    \n    tinytable_wskziu8isloh8j87ac7r\n    \n    \n    \n    \n  \n\n  \n    \n      \n        \n        \n              \n                 \n                Clustered\n                Basis\n              \n        \n        \n        \n                \n                  racial_seg\n                  -0.03         \n                  -0.05        \n                \n                \n                            \n                  [-0.16, 0.10] \n                  [-0.26, 0.17]\n                \n                \n                            \n                  p = 0.59      \n                  p = 0.45     \n                \n                \n                  single_mom\n                  -0.71         \n                  -0.56        \n                \n                \n                            \n                  [-0.91, -0.50]\n                  [-1.51, 0.38]\n                \n                \n                            \n                  p = &lt;0.01     \n                  p = 0.12     \n                \n                \n                  Num.Obs.  \n                  100           \n                  100          \n                \n                \n                  R2        \n                  0.605         \n                  0.691        \n                \n        \n      \n    \n\n    \n\n  \n\n\n\n\nIt can be seen here that, despite the strong spatial trends in the data, adding a spline basis and using only three clusters does not alter the results markedly compared with naive clustering by state."
  }
]