{
  "hash": "f31899a76951e0b987c39e34ed1603de",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tutorial\"\nauthor: \"Morgan Kelly\"\neditor: visual\nformat:\n  html:\n    toc: true\n    html-math-method: katex\n    css: styles.css\nexecute:\n  freeze: auto \n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spatInfer)\n```\n:::\n\n\nVignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The html_vignette output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spatInfer)\n\ndata(opportunity)\nset.seed(123)\nopportunity=opportunity |> dplyr::slice_sample(n=100)\n```\n:::\n\n\n## 1. Choose the Spatial Basis\n\nNow run the regression and print output\n\n\n::: {.cell Cache='false'}\n\n```{.r .cell-code}\noptimal_basis(mobility~racial_seg+single_mom, opportunity,\n              max_splines=5)\n```\n\n::: {.cell-output-display}\n![](tutorial_files/figure-html/fig-basis-1.png){#fig-basis width=480}\n:::\n:::\n\n\n## 2. Run Placebo Test\n\nnext run placebo test.\n\n\n::: {.cell Cache='false'}\n\n```{.r .cell-code}\nplbo=placebo(mobility~racial_seg+single_mom, opportunity,\n                 splines=4, pc_num=3,\n                 nSim=50,\n                 Parallel=T\n                 )\nplacebo_table(plbo)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_7t11k9me9bt1uustocz6</title>\n    <style>\n.table td.tinytable_css_ddn5yg33n34abaswsmrn, .table th.tinytable_css_ddn5yg33n34abaswsmrn {   padding-left: 1em; }\n.table td.tinytable_css_8jya73cq7je7dgbenvy5, .table th.tinytable_css_8jya73cq7je7dgbenvy5 {    text-align: center; }\n.table td.tinytable_css_45sszhdu0qmvyyn7zmak, .table th.tinytable_css_45sszhdu0qmvyyn7zmak {    font-weight: bold; text-align: left; }\n.table td.tinytable_css_6ew13zmwa0p0x3sz9y7e, .table th.tinytable_css_6ew13zmwa0p0x3sz9y7e {    font-weight: bold; }\n.table td.tinytable_css_klrbkl7jkyo4xzz605si, .table th.tinytable_css_klrbkl7jkyo4xzz605si {    color: orange; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-striped\" id=\"tinytable_7t11k9me9bt1uustocz6\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\">Clusters</th>\n                <th scope=\"col\">Est p</th>\n                <th scope=\"col\">Plac p</th>\n                <th scope=\"col\">Plac 5%</th>\n                <th scope=\"col\">CI Width</th>\n                <th scope=\"col\">CI</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Moran=3.34, Structure=0.03, Effective Range=0.15, R2=0.02.</td></tr>\n<tr><td colspan='6'>Splines=4, PCs=3.</td></tr>\n<tr><td colspan='6'>Estimated and placebo p values and proportion of placebo regressions significant at 5%, along\n                with confidence intervals. R2 gives the explanatory power of a regression of the treatment on the principal components.</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td>.</td>\n                  <td>0.4 </td>\n                  <td>0.38</td>\n                  <td>0.06</td>\n                  <td>4.7</td>\n                  <td>[-3.34, 1.34]</td>\n                </tr>\n                <tr>\n                  <td>3</td>\n                  <td>0.45</td>\n                  <td>0.46</td>\n                  <td>0.02</td>\n                  <td>9.2</td>\n                  <td>[-5.61, 3.61]</td>\n                </tr>\n                <tr>\n                  <td>4</td>\n                  <td>0.38</td>\n                  <td>0.44</td>\n                  <td>0.1 </td>\n                  <td>6.2</td>\n                  <td>[-4.12, 2.12]</td>\n                </tr>\n                <tr>\n                  <td>5</td>\n                  <td>0.39</td>\n                  <td>0.4 </td>\n                  <td>0.04</td>\n                  <td>5.8</td>\n                  <td>[-3.89, 1.89]</td>\n                </tr>\n                <tr>\n                  <td>6</td>\n                  <td>0.51</td>\n                  <td>0.46</td>\n                  <td>0.06</td>\n                  <td>7.2</td>\n                  <td>[-4.61, 2.61]</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_0za93b0cour7u892oe95(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_7t11k9me9bt1uustocz6\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow_d15nwb5gdgpp0ymx8v05(i, colspan, content) {\n        var table = document.getElementById('tinytable_7t11k9me9bt1uustocz6');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_0za93b0cour7u892oe95(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_7t11k9me9bt1uustocz6\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { insertSpanRow_d15nwb5gdgpp0ymx8v05(2, 6, 'BCH') });\nwindow.addEventListener('load', function () { insertSpanRow_d15nwb5gdgpp0ymx8v05(1, 6, 'HC') });\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(2, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(4, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(5, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(6, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(7, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 0, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 1, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 2, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 3, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 4, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(-1, 5, 'tinytable_css_8jya73cq7je7dgbenvy5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 0, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 0, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 1, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 1, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 2, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 2, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 3, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 3, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 4, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 4, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 5, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 5, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 0, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 1, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 2, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 3, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 4, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 5, 'tinytable_css_6ew13zmwa0p0x3sz9y7e') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(0, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(1, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(2, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(3, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(4, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(5, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(6, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\nwindow.addEventListener('load', function () { styleCell_tinytable_0za93b0cour7u892oe95(7, 3, 'tinytable_css_klrbkl7jkyo4xzz605si') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n## 3. Run a Synthetic Outcome Test\n\nFollowing the placebo test, the next step is to calculate the synthetic outcome p-value: What is the significance level of the null hypothesis that the outcome is determined by trending noise of a specified form?\n\nWe assume that the outcome is generated as a quadratic in longitude and latitude with residuals again being generated by a spatial noise process with the same exponential parameters: here there is a structure of 0.37 and effective range of 0.1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsynt_bch=synth_bch(mobility~racial_seg+single_mom,  opportunity,\n                 splines=4, pc_num=3,\n                  nSim=50,\n                 Parallel=T)\nsynth_table(synt_bch)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_w62xo9apwlvh445mji3q</title>\n    <style>\n.table td.tinytable_css_d15nwb5gdgpp0ymx8v05, .table th.tinytable_css_d15nwb5gdgpp0ymx8v05 {   padding-left: 1em; }\n.table td.tinytable_css_ddn5yg33n34abaswsmrn, .table th.tinytable_css_ddn5yg33n34abaswsmrn {    text-align: center; }\n.table td.tinytable_css_k8ahxed8bil0kfo8i89h, .table th.tinytable_css_k8ahxed8bil0kfo8i89h {    font-weight: bold; text-align: left; }\n.table td.tinytable_css_45sszhdu0qmvyyn7zmak, .table th.tinytable_css_45sszhdu0qmvyyn7zmak {    font-weight: bold; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-striped\" id=\"tinytable_w62xo9apwlvh445mji3q\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\">Clusters</th>\n                <th scope=\"col\">Est p</th>\n                <th scope=\"col\">Synth p</th>\n                <th scope=\"col\">CI Width</th>\n                <th scope=\"col\">CI</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='5'>Moran=3.34, Structure=0.89, Effective Range=0.1, R2=0.36.</td></tr>\n<tr><td colspan='5'>Splines=4, PCs=3.</td></tr>\n<tr><td colspan='5'>Estimated and synthetic outcome p values for different cluster numbers.\n                R2 gives the explanatory power of a regression of the outcome on a quadratic in longitude and latitude.</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td>.</td>\n                  <td>0.4 </td>\n                  <td>0.6 </td>\n                  <td>4.7</td>\n                  <td>[-3.34, 1.34]</td>\n                </tr>\n                <tr>\n                  <td>3</td>\n                  <td>0.45</td>\n                  <td>0.62</td>\n                  <td>9.2</td>\n                  <td>[-5.61, 3.61]</td>\n                </tr>\n                <tr>\n                  <td>4</td>\n                  <td>0.38</td>\n                  <td>0.58</td>\n                  <td>6.2</td>\n                  <td>[-4.12, 2.12]</td>\n                </tr>\n                <tr>\n                  <td>5</td>\n                  <td>0.39</td>\n                  <td>0.56</td>\n                  <td>5.8</td>\n                  <td>[-3.89, 1.89]</td>\n                </tr>\n                <tr>\n                  <td>6</td>\n                  <td>0.51</td>\n                  <td>0.68</td>\n                  <td>7.2</td>\n                  <td>[-4.61, 2.61]</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_ga7ho8x6lsp3sywwk8op(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_w62xo9apwlvh445mji3q\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow_h93xa8bmr28e3n2a33ju(i, colspan, content) {\n        var table = document.getElementById('tinytable_w62xo9apwlvh445mji3q');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_ga7ho8x6lsp3sywwk8op(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_w62xo9apwlvh445mji3q\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { insertSpanRow_h93xa8bmr28e3n2a33ju(2, 5, 'BCH') });\nwindow.addEventListener('load', function () { insertSpanRow_h93xa8bmr28e3n2a33ju(1, 5, 'HC') });\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(2, 0, 'tinytable_css_d15nwb5gdgpp0ymx8v05') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(4, 0, 'tinytable_css_d15nwb5gdgpp0ymx8v05') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(5, 0, 'tinytable_css_d15nwb5gdgpp0ymx8v05') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(6, 0, 'tinytable_css_d15nwb5gdgpp0ymx8v05') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(7, 0, 'tinytable_css_d15nwb5gdgpp0ymx8v05') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(-1, 0, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(-1, 1, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(-1, 2, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(-1, 3, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(-1, 4, 'tinytable_css_ddn5yg33n34abaswsmrn') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(1, 0, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(3, 0, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(1, 1, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(3, 1, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(1, 2, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(3, 2, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(1, 3, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(3, 3, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(1, 4, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(3, 4, 'tinytable_css_k8ahxed8bil0kfo8i89h') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(0, 0, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(0, 1, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(0, 2, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(0, 3, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\nwindow.addEventListener('load', function () { styleCell_tinytable_ga7ho8x6lsp3sywwk8op(0, 4, 'tinytable_css_45sszhdu0qmvyyn7zmak') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\nFor the three clusters chosen by the placebo test, the synthetic outcome significance level is 0.02, identical to the placebo one.\n\n## 4. Estimate the Spatial Basis Regression\n\nThe fact that the placebo and synthetic outcome significance levels closely match the regression one gives us considerable confidence in the reliability of the regression estimate. We therefore estimate a regression with 4 principal components of a 4x4 spline, and compute standard errors using 3 k-medoids clusters.\n\nFor comparison we also include a regression with no spatial adjustment where standard errors are clustered by state.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCK=CK_regression(mobility~racial_seg+single_mom,  opportunity,\n                 splines=4,pc_num=3,\n                 clusters=3)\n\nClust=fixest::feols(mobility~racial_seg+single_mom,  opportunity,\n              cluster= ~state)\n\nmodelsummary::modelsummary(list(Clustered=Clust, Basis=CK),\n                           statistic = c(\"conf.int\",\"p = {p.value}\"),\n                           coef_omit = c(\"Intercept|PC*\"), #omit basis and intercept\n                           gof_map = c(\"nobs\", \"r.squared\"),\n                            fmt=2)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_wskziu8isloh8j87ac7r</title>\n    <style>\n.table td.tinytable_css_gu30gjmp7nk1kch257zx, .table th.tinytable_css_gu30gjmp7nk1kch257zx {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_k12hchqmp3v25xtyvdvt, .table th.tinytable_css_k12hchqmp3v25xtyvdvt {    text-align: left; }\n.table td.tinytable_css_fh1liazxu9irf6bo2n1x, .table th.tinytable_css_fh1liazxu9irf6bo2n1x {    text-align: center; }\n.table td.tinytable_css_c0ur4825zz2k1k8fyja4, .table th.tinytable_css_c0ur4825zz2k1k8fyja4 {    text-align: center; }\n.table td.tinytable_css_f14bogmufbcd48fq7mkg, .table th.tinytable_css_f14bogmufbcd48fq7mkg {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_wskziu8isloh8j87ac7r\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">Clustered</th>\n                <th scope=\"col\">Basis</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>racial_seg</td>\n                  <td>-0.03         </td>\n                  <td>-0.05        </td>\n                </tr>\n                <tr>\n                  <td>          </td>\n                  <td>[-0.16, 0.10] </td>\n                  <td>[-0.26, 0.17]</td>\n                </tr>\n                <tr>\n                  <td>          </td>\n                  <td>p = 0.59      </td>\n                  <td>p = 0.45     </td>\n                </tr>\n                <tr>\n                  <td>single_mom</td>\n                  <td>-0.71         </td>\n                  <td>-0.56        </td>\n                </tr>\n                <tr>\n                  <td>          </td>\n                  <td>[-0.91, -0.50]</td>\n                  <td>[-1.51, 0.38]</td>\n                </tr>\n                <tr>\n                  <td>          </td>\n                  <td>p = <0.01     </td>\n                  <td>p = 0.12     </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.  </td>\n                  <td>100           </td>\n                  <td>100          </td>\n                </tr>\n                <tr>\n                  <td>R2        </td>\n                  <td>0.605         </td>\n                  <td>0.691        </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_tpu3ioigrubc8a9o922g(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_wskziu8isloh8j87ac7r\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_wskziu8isloh8j87ac7r');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_tpu3ioigrubc8a9o922g(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_wskziu8isloh8j87ac7r\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 0, 'tinytable_css_gu30gjmp7nk1kch257zx') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 1, 'tinytable_css_gu30gjmp7nk1kch257zx') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 2, 'tinytable_css_gu30gjmp7nk1kch257zx') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(1, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(2, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(3, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(4, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(5, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(7, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(8, 0, 'tinytable_css_k12hchqmp3v25xtyvdvt') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(1, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(2, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(3, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(4, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(5, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(7, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(8, 1, 'tinytable_css_fh1liazxu9irf6bo2n1x') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(0, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(1, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(2, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(3, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(4, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(5, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(7, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(8, 2, 'tinytable_css_c0ur4825zz2k1k8fyja4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 0, 'tinytable_css_f14bogmufbcd48fq7mkg') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 1, 'tinytable_css_f14bogmufbcd48fq7mkg') })\nwindow.addEventListener('load', function () { styleCell_tinytable_tpu3ioigrubc8a9o922g(6, 2, 'tinytable_css_f14bogmufbcd48fq7mkg') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\nIt can be seen here that, despite the strong spatial trends in the data, adding a spline basis and using only three clusters does not alter the results markedly compared with naive clustering by state.",
    "supporting": [
      "tutorial_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}